implement the plan for refactoring as defined in "docs/REFACTORING_OPPORTUNITIES.md"